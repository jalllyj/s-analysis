# 飞书网页应用配置指南

## 什么是飞书网页应用？

飞书网页应用允许你在飞书内部打开自定义的网页，用户体验更好，无需跳出到浏览器。

## 前置要求

✅ 必须有一个**公网可访问的URL**（域名或IP）
✅ 支持 HTTPS（飞书强制要求）
✅ 飞书企业版或旗舰版账号

## 配置步骤

### 步骤1：准备公网地址

你需要一个公网可访问的地址，例如：
- `https://your-domain.com/admin/topup`
- `https://123.45.67.89/admin/topup`（必须HTTPS）

**如果没有公网服务器**，建议使用方案1（ngrok内网穿透）。

### 步骤2：在飞书开放平台配置

1. **登录飞书开放平台**
   - 访问：https://open.feishu.cn/
   - 进入你之前创建的应用

2. **添加网页应用**
   - 点击左侧"网页应用"
   - 点击"添加网页应用"
   - 填写基本信息：
     - 应用名称：充值审核后台
     - 应用描述：管理用户充值审核

3. **配置首页地址**
   - 首页地址：`https://your-domain.com/admin/topup`
   - 移动端首页地址：`https://your-domain.com/admin/topup`

4. **配置权限**
   - 添加必要的权限（如需要）

5. **启用应用**
   - 点击"启用"或"发布"

### 步骤3：在飞书中使用

1. **添加应用**
   - 在飞书中，点击"+" → "应用"
   - 搜索你的应用名称
   - 添加到工作台

2. **打开应用**
   - 点击应用图标
   - 会在飞书内部打开管理后台页面

### 步骤4：修改飞书消息中的链接

将飞书消息中的链接改为使用飞书网页应用的方式：

```typescript
// 方式1：使用飞书链接（推荐）
{
  tag: 'button',
  text: { tag: 'plain_text', content: '📋 前往审核' },
  type: 'primary',
  url: 'https://open.feishu.cn/open-apis/bot/v2/hook/xxx'  // 飞书内部链接
}

// 方式2：使用 open_id 打开（需要用户授权）
{
  tag: 'button',
  text: { tag: 'plain_text', content: '📋 前往审核' },
  type: 'primary',
  url: 'feishu://open?open_id=xxx'  // 飞书协议
}
```

## 优点

✅ 用户体验更好（在飞书内部打开）
✅ 可以获取飞书用户信息
✅ 支持飞书授权登录
✅ 统一的用户界面

## 缺点

❌ 需要公网服务器
❌ 必须支持HTTPS
❌ 需要企业版飞书账号
❌ 配置相对复杂

## 推荐方案

**如果你现在没有公网服务器**，建议使用 **方案1（ngrok内网穿透）**：

1. 安装 ngrok（2分钟）
2. 运行 `ngrok http 5000`
3. 复制公网地址
4. 修改环境变量
5. 完成！

**如果你有公网服务器**，可以配置飞书网页应用，体验会更好。

## 快速对比

| 特性 | ngrok内网穿透 | 飞书网页应用 |
|------|--------------|--------------|
| 需要公网服务器 | ❌ 不需要 | ✅ 需要 |
| 需要HTTPS | ✅ 自动支持 | ✅ 需要 |
| 配置难度 | ⭐ 简单 | ⭐⭐⭐ 复杂 |
| 用户体验 | ⭐⭐⭐⭐⭐ 在浏览器打开 | ⭐⭐⭐⭐⭐ 在飞书内打开 |
| 适合场景 | 快速测试/个人使用 | 生产环境/企业使用 |

## 建议

**现在先用 ngrok 快速解决问题，后续有公网服务器再配置飞书网页应用。**
